#+title:  Constraints for =del_user=


* constraints

Instr = {cmd: "del_user", 
         session: {key: is_key_str, 
                   email:  is_email_str, 
                   role: is_role_str}
         user_email: is_email_str}

   1. Type check instr

   1. Let is = instr['session']      # instruction's session component
   2. Let eud = instr['user_email']  # email of user to be  deleted
   
      # session must exist in em. ow,
      # ow, invalidSessionException
   3. Let s = em.getSessionForKey(is['key'])  # could fail

      # u must exist in em. 
      # ow, invalidSessionxception
   4. Let u = em.getUserForEmail(is['email']) # could fail

      # ud must exist in em.  ow, invalid
   5. Let ud = em.getUserForEmail(eud)  # could fail

	  # session's user should match instruction's user. 
      # ow, InvalidSessionCredentials
   6. Check if s.user = u   

      # a user can not delete herself
   7. Check if u != ud  

      # only admin may delete a user
   8. Check if is['role'] == "admin"

      # user carrying out request has admin permission
   9. Check if "admin" in map(to_str, u.roles) 




  

      

   



